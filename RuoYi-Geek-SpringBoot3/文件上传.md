# 文件上传

核心设计模式参考：桥接模式

## 核心类

### 基础对象

1. StorageBucket： 存储桶，实现最基础的存储操作。
2. StorageEntity： 存储实体，用来描述存储桶内的内容。
3. StorageManagement： 存储管理者，用来管理某类型的所有存储桶。

### 基础工具

1. StorageUtils（BeanUtils）： 存储工具类，用来加载存储服务和获取存储桶。
2. FileOperateUtils：基于默认存储服务的默认存储桶进行便捷的文件操作。

### 桥接类

StorageService：基于存储桶的基础操作增加业务的部分内容，如秒传、扩展名校验等。

### 应用案例

#### 基于FileOperateUtils实现基础操作

经典应用方式：通过FileOperateUtils使用默认存储服务的默认存储桶进行边界的文件操作，在单服务单存储桶的业务中提供便捷的操作。

```java
String url = FileOperateUtils.upload(filePath, file);
FileOperateUtils.downLoad(filePath,response);
boolean flag = FileOperateUtils.deleteFile(filePath);
String url = FileOperateUtils.getURL(filePath);
```

#### 基于StorageService实现基础操作

经典应用方式：通过StorageUtils获取StorageBucket后构建StorageService对象进行文件操作，在多服务多存储桶的业务中提供便捷的操作，FileController有更全面的应用示例。

```java
// 第一步：获取储存桶
StorageBucket storageBucket = StorageUtils.getStorageBucket(storageType, clientName);
// 第二步： 构建基于该桶的业务桥接类
StorageService storageService = new StorageService(storageBucket);
// 第三步： 通过业务类进行上传、下载等操作
String url = storageService.upload(filePath, file);
InputStream inputStream = storageService.downLoad(filePath);
StorageEntity storageEntity = storageService.getFile(filePath);
boolean flag = storageService.deleteFile(filePath);
String url = storageService.generateUrl(filePath);
```

#### 基于StorageService实现分片上传

```java
String uploadId = storageService.initMultipartUpload(filePath,fileSize);
String eTag = storageService.uploadPart(filePath,uploadId,partNumber,partSize,inputStream);
String filepath = storageService.completeMultipartUpload(filePath,uploadId,partEtags)
```
